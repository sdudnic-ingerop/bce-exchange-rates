<header>
  <div class="container">
    <div class="header-content">
      <a class="logo" (click)="navigateTo('home')" style="cursor: pointer;">
        <img src="/ecb_logo.svg" alt="BCE Logo" style="height: 40px; width: auto;">
        <h1>Taux de Change BCE</h1>
      </a>
      <nav>
        <button [class.active]="currentView === 'home'" (click)="navigateTo('home')">
          Accueil
        </button>
        <button [class.active]="currentView === 'docs'" (click)="navigateTo('docs')">
          Docs API
        </button>
      </nav>
    </div>
  </div>
</header>

<main class="container">
  <!-- Home View -->
  <div *ngIf="currentView === 'home'">
    <!-- Controls Section -->
    <section class="controls-section">
      <div class="currency-control">
        <mat-form-field appearance="outline">
          <mat-label>Devises</mat-label>
          <mat-chip-grid #chipGrid>
            <mat-chip-row *ngFor="let currency of selectedCurrencies" 
                          (removed)="removeCurrency(currency)">
              <img [src]="getFlagUrl(getCurrencyFlag(currency))" [alt]="currency" style="width: 20px; height: 15px; margin-right: 4px;">
              {{ currency }}
              <button matChipRemove>
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
            <input
              placeholder="Chercher par code ou pays..."
              [matChipInputFor]="chipGrid"
              [(ngModel)]="currencyFilter"
              [matAutocomplete]="auto"
            />
          </mat-chip-grid>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectCurrency($event.option.value)">
            <mat-option *ngFor="let code of filteredCurrencies" [value]="code">
              <div style="display: flex; align-items: center; gap: 8px;">
                <img [src]="getFlagUrl(getCurrencyFlag(code))" [alt]="code" style="width: 20px; height: 15px;">
                <span><strong>{{ code }}</strong> — {{ currencyToCountry[code] }}</span>
              </div>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>
      
      <div class="date-control">
        <mat-form-field appearance="outline">
          <mat-label>Date (optionnel)</mat-label>
          <input 
            matInput 
            [matDatepicker]="picker"
            [(ngModel)]="selectedDate" 
            (dateChange)="onDateChange()"
            [max]="maxDate"
            placeholder="Laisser vide pour le taux le plus récent"
          />
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <button 
            *ngIf="selectedDate" 
            matSuffix 
            mat-icon-button 
            (click)="selectedDate = null; onDateChange()" 
            title="Supprimer la date"
            [matTooltip]="'Supprimer la date'"
            style="position: absolute; right: 50px;"
          >
            <mat-icon>clear</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </section>

    <!-- Loading / Error Messages -->
    <div *ngIf="loading" class="loading-message">
      Chargement des données...
    </div>

    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <!-- Content Grid: Table + Chart -->
    <div *ngIf="!loading && exchangeRates.length > 0" class="content-grid">
      <!-- Left Column: Table and CSV -->
      <section class="table-section">
        <div class="section-header">
          <div class="section-title">Taux</div>
          <button 
            class="icon-button-csv" 
            (click)="exportCSV()" 
            [disabled]="exchangeRates.length === 0"
            title="Télécharger les taux en CSV"
            [matTooltip]="'Télécharger les taux en CSV'"
          >
            <mat-icon>download</mat-icon>
          </button>
        </div>

        <table>
          <thead>
            <tr>
              <th class="table-header">Devise</th>
              <th class="table-header">Taux EUR</th>
              <th class="table-header">{{ selectedDate ? 'Date' : 'Dernière date dispo.' }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rate of exchangeRates">
              <td class="currency-cell">
                <img [src]="getFlagUrl(rate.flag)" [alt]="rate.currency">
                <span>{{ rate.currency }}</span>
              </td>
              <td class="rate-cell">
                {{ rate.rate !== null && rate.rate !== undefined ? rate.rate.toFixed(4) : '-' }}
              </td>
              <td class="date-cell">
                {{ rate.date ? formatDateForDisplay(parseDate(rate.date)) : '-' }}
              </td>
            </tr>
          </tbody>
        </table>

        <!-- API Response Example -->
        <div class="api-response-example">
          <div class="api-request">
            <code class="request-url">{{ getApiRequestUrl() }}</code>
          </div>
          <div class="api-response">
            <pre><code>{{ apiResponseExample }}</code></pre>
          </div>
        </div>
      </section>

      <!-- Right Column: Chart -->
      <section class="chart-section">
        <div class="chart-header">
          <div class="section-title">Historique</div>
          
          <div class="period-selector">
            <label>
              <input 
                type="radio" 
                name="period" 
                value="Mois" 
                [(ngModel)]="selectedPeriod"
                (change)="onPeriodChange()"
              />
              <span>Mois</span>
            </label>
            <label>
              <input 
                type="radio" 
                name="period" 
                value="Trimestre" 
                [(ngModel)]="selectedPeriod"
                (change)="onPeriodChange()"
              />
              <span>Trimestre</span>
            </label>
            <label>
              <input 
                type="radio" 
                name="period" 
                value="Année" 
                [(ngModel)]="selectedPeriod"
                (change)="onPeriodChange()"
              />
              <span>Année</span>
            </label>
          </div>
        </div>

        <div class="chart-container">
          <canvas #ratesChart id="ratesChart"></canvas>
        </div>
      </section>
    </div>
  </div>

  <!-- Docs View -->
  <div *ngIf="currentView === 'docs'" class="docs-container">
    <app-docs-section></app-docs-section>
  </div>
</main>

